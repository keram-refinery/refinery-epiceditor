(function(window, $, refinery){'use strict';refinery.Object.create({name:"EpicEditor",module:"editor",options:{container:"epiceditor",textarea:null,basePath:"/assets/refinery/epiceditor/",clientSideStorage:!0,localStorageName:"epiceditor",useNativeFullscreen:!0,parser:marked,file:{name:"refinery",defaultContent:"",autoSave:!1},theme:{base:"themes/base/epiceditor.css",preview:"themes/preview/refinery.css",editor:"themes/editor/refinery.css"},button:{preview:!0,fullscreen:!0},focusOnLoad:!1,shortcut:{modifier:18,fullscreen:70,preview:80},
string:{togglePreview:t("refinery.editor.toggle_preview_mode"),toggleEdit:t("refinery.editor.toggle_edit_mode"),toggleFullscreen:t("refinery.editor.enter_fullscreen")}},editor:null,insert:function(c){this.editor.edit();this.editor.editorIframeDocument.execCommand("insertText",!1,c)},f:function(){var c=this,a=c.a,b,a=$("<button/>",{title:t("refinery.editor.images_dialog_button_title"),"class":"editor-images-dialog-btn refinery-btn"}).prependTo(a);b=refinery("admin.ImagesDialog");a.on("click",function(a){a.preventDefault();
a.stopPropagation();b.init().open();return!1});b.on("insert",function(a){var b;b="![%alt](%url)".replace("%alt","");b=b.replace("%url",a[a.size]);c.insert(b)});c.c=b},h:function(){var c=this,a=c.a,b,a=$("<button/>",{title:t("refinery.editor.resources_dialog_button_title"),"class":"editor-resources-dialog-btn refinery-btn"}).prependTo(a);b=refinery("admin.ResourcesDialog");a.on("click",function(a){a.preventDefault();a.stopPropagation();b.init().open();return!1});b.on("insert",function(a){var b;b='<a href="%url" class="file">%title</a>'.replace("%url",
a.url);switch(a.type){case "library":b=b.replace("%title",a.html)}c.insert(b)});c.b=b},g:function(){var c=this,a=c.a,b,a=$("<button/>",{title:t("refinery.editor.links_dialog_button_title"),"class":"editor-links-dialog-btn refinery-btn"}).prependTo(a);b=refinery("admin.LinksDialog");a.on("click",function(a){a.preventDefault();a.stopPropagation();b.init().open();return!1});b.on("insert",function(a){var b;b="[%title](%url)".replace("%title",a.title);b=b.replace("%url",a.url);c.insert(b)});c.d=b},destroy:function(c){this.is("initialised")&&
(this.editor&&(this.editor=null),this.c&&this.c.destroy(!0),this.b&&this.b.destroy(!0),this.d&&this.d.destroy(!0),this.holder.find(".epiceditor-holder").remove(),this.e.remove());this._destroy(c);return this},init:function(c){var a=this,b,d;a.is("initialisable")&&(a.is("initialising",!0),a.attach_holder(c),b=c.find("textarea"),d=$("<div/>",{"class":"epiceditor-holder"}).appendTo(c),a.options.container=d.get(0),a.options.textarea=b.get(0),b.hide(),a.options.file.name="refinery"+this.uid,a.editor=new EpicEditor(a.options),
a.editor.remove(a.options.file.name),a.editor.load(),a.a=$(a.editor.getElement("wrapper")).find("#epiceditor-utilbar"),a.e=$("<button/>",{"class":"epiceditor-toggle-button",text:t("refinery.editor.toggle_editor")}).appendTo(c),a.e.on("click",function(){var c=b.val();d.toggle();b.toggle();a.editor.is("loaded")?(a.editor.unload(),b.val(c)):(a.editor.load(),a.editor.importFile(a.options.file.name,c))}),a.f(),a.h(),a.g(),a.is({initialised:!0,initialising:!1}),a.trigger("init"));return a}});
refinery.admin.ui.editorEpicEditor=function(c){var a=c.find(".ui-tabs"),b=[];c.find("textarea.replace-with-editor").each(function(){var a=$(this).parent();b[b.length]=refinery("editor.EpicEditor").init(a)});a.on("tabsactivate",function(){for(var a=b.length-1;0<=a;a--)b[a].editor&&b[a].editor.reflow()})};}(window, jQuery, window.refinery));
