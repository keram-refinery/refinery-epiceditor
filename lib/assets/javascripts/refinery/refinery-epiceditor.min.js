(function(window, $, refinery){'use strict';refinery.Object.create({name:"EpicEditor",module:"editor",options:{container:"epiceditor",textarea:null,basePath:"/assets/refinery/epiceditor/",clientSideStorage:!0,localStorageName:"epiceditor",useNativeFullscreen:!0,parser:marked,file:{name:"refinery",defaultContent:"",autoSave:!1},theme:{base:"themes/base/epiceditor.css",preview:"themes/preview/refinery.css",editor:"themes/editor/refinery.css"},button:{preview:!0,fullscreen:!0},focusOnLoad:!1,shortcut:{modifier:18,fullscreen:70,preview:80},
string:{togglePreview:t("refinery.editor.toggle_preview_mode"),toggleEdit:t("refinery.editor.toggle_edit_mode"),toggleFullscreen:t("refinery.editor.enter_fullscreen")}},editor:null,insert:function(a){this.editor.edit();this.editor.editorIframeDocument.execCommand("insertText",!1,a)},e:function(){var a=this,c=a.a,b,c=$("<button/>",{title:t("refinery.editor.images_dialog_button_title"),"class":"editor-images-dialog-btn refinery-btn"}).prependTo(c);b=refinery("admin.ImagesDialog");c.on("click",function(d){d.preventDefault();
d.stopPropagation();b.init().open();return!1});b.on("insert",function(d){var b;b="![%alt](%url)".replace("%alt","");b=b.replace("%url",d[d.size]);a.insert(b)});a.c=b},g:function(){var a=this,c=a.a,b,c=$("<button/>",{title:t("refinery.editor.resources_dialog_button_title"),"class":"editor-resources-dialog-btn refinery-btn"}).prependTo(c);b=refinery("admin.ResourcesDialog");c.on("click",function(d){d.preventDefault();d.stopPropagation();b.init().open();return!1});b.on("insert",function(b){var c;c='<a href="%url" class="file">%title</a>'.replace("%url",
b.url);switch(b.type){case "library":c=c.replace("%title",b.html)}a.insert(c)});a.b=b},f:function(){var a=this,c=a.a,b,c=$("<button/>",{title:t("refinery.editor.links_dialog_button_title"),"class":"editor-links-dialog-btn refinery-btn"}).prependTo(c);b=refinery("admin.LinksDialog");c.on("click",function(a){a.preventDefault();a.stopPropagation();b.init().open();return!1});b.on("insert",function(b){var c;c="[%title](%url)".replace("%title",b.title);c=c.replace("%url",b.url);a.insert(c)});a.d=b},destroy:function(a){this.is("initialised")&&
(this.editor&&(this.editor=null),this.c&&this.c.destroy(!0),this.b&&this.b.destroy(!0),this.d&&this.d.destroy(!0),this.holder.find(".epiceditor-holder").remove());this._destroy(a);return this},init:function(a){var c;this.is("initialisable")&&(this.is("initialising",!0),this.attach_holder(a),c=a.find("textarea"),a=$("<div/>",{"class":"epiceditor-holder"}).appendTo(a),this.options.container=a.get(0),this.options.textarea=c.get(0),c.hide(),this.options.file.name="refinery"+this.uid,this.editor=new EpicEditor(this.options),
this.editor.remove(this.options.file.name),this.editor.load(),this.a=$(this.editor.getElement("wrapper")).find("#epiceditor-utilbar"),this.e(),this.g(),this.f(),this.is({initialised:!0,initialising:!1}),this.trigger("init"));return this}});
refinery.admin.ui.editorEpicEditor=function(a){var c=a.find(".ui-tabs"),b=[];a.find("textarea.replace-with-editor").each(function(){var a=$(this).parent();b[b.length]=refinery("editor.EpicEditor").init(a)});c.on("tabsactivate",function(){for(var a=b.length-1;0<=a;a--)b[a].editor&&b[a].editor.reflow()})};}(window, jQuery, window.refinery));
