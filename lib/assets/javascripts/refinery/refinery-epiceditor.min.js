(function(window, $, refinery){'use strict';refinery.Object.create({name:"EpicEditor",module:"editor",options:{container:"epiceditor",textarea:null,basePath:"/assets/refinery/epiceditor/",clientSideStorage:!0,localStorageName:"epiceditor",useNativeFullscreen:!0,parser:marked,file:{name:"refinery",defaultContent:"",autoSave:!1},theme:{base:"themes/base/epiceditor.css",preview:"themes/preview/refinery.css",editor:"themes/editor/refinery.css"},button:{preview:!0,fullscreen:!0},focusOnLoad:!1,shortcut:{modifier:18,fullscreen:70,preview:80},
string:{togglePreview:t("refinery.editor.toggle_preview_mode"),toggleEdit:t("refinery.editor.toggle_edit_mode"),toggleFullscreen:t("refinery.editor.enter_fullscreen")}},insert:function(c){this.a.edit();this.a.editorIframeDocument.execCommand("insertText",!1,c)},c:function(){var c=this,b=c.b,a,b=$("<button/>",{title:t("refinery.editor.images_dialog_button_title"),"class":"editor-images-dialog-btn refinery-btn"}).prependTo(b);a=refinery("admin.ImagesDialog");b.on("click",function(d){d.preventDefault();
d.stopPropagation();a.init().open();return!1});a.on("insert",function(d){var a;a="![%alt](%url)".replace("%alt","");a=a.replace("%url",d.original);c.insert(a)});c.img_dialog=a},e:function(){var c=this,b=c.b,a,b=$("<button/>",{title:t("refinery.editor.resources_dialog_button_title"),"class":"editor-resources-dialog-btn refinery-btn"}).prependTo(b);a=refinery("admin.ResourcesDialog");b.on("click",function(d){d.preventDefault();d.stopPropagation();a.init().open();return!1});a.on("insert",function(a){var b;
b='<a href="%url" class="file">%title</a>'.replace("%url",a.url);switch(a.type){case "library":b=b.replace("%title",a.html)}c.insert(b)});c.file_dialog=a},d:function(){var c=this,b=c.b,a,b=$("<button/>",{title:t("refinery.editor.links_dialog_button_title"),"class":"editor-links-dialog-btn refinery-btn"}).prependTo(b);a=refinery("admin.LinksDialog");b.on("click",function(c){c.preventDefault();c.stopPropagation();a.init().open();return!1});a.on("insert",function(a){var b;b="[%title](%url)".replace("%title",
a.title);b=b.replace("%url",a.url);c.insert(b)});c.link_dialog=a},destroy:function(c){this.is("initialised")&&(this.a&&(this.a=null),this.img_dialog&&this.img_dialog.destroy(),this.file_dialog&&this.file_dialog.destroy(),this.link_dialog&&this.link_dialog.destroy(),this.holder.find(".epiceditor-holder").remove());refinery.Object.prototype.destroy.apply(this,[c]);return this},init:function(c){var b,a;this.is("initialisable")&&(this.is("initialising",!0),this.holder=c,b=c.find("textarea"),a=$("<div/>",
{"class":"epiceditor-holder"}).appendTo(c),this.options.container=a.get(0),this.options.textarea=b.get(0),b.hide(),this.options.file.name="refinery"+this.uid,this.a=new EpicEditor(this.options),this.a.remove(this.options.file.name),this.a.load(),this.b=$(this.a.getElement("wrapper")).find("#epiceditor-utilbar"),this.c(),this.e(),this.d(),refinery.Object.attach(this.uid,c),this.is({initialised:!0,initialising:!1}),this.trigger("init"));return this}});
refinery.admin.ui.editorEpicEditor=function(c){var b=c.find(".ui-tabs"),a=[];c.find("textarea.replace-with-editor").each(function(){var b=$(this).parent();a[a.length]=refinery("editor.EpicEditor").init(b)});b.on("tabsactivate",function(){for(var b=a.length-1;0<=b;b--)a[b].a&&a[b].a.reflow()})};}(window, jQuery, window.refinery));
