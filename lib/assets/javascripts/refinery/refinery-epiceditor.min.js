(function(window, $){'use strict';refinery.Object.create({name:"EpicEditor",module:"editor",options:{container:"epiceditor",textarea:null,basePath:"/assets/refinery/epiceditor/",clientSideStorage:!0,localStorageName:"epiceditor",useNativeFullscreen:!0,parser:marked,file:{name:"refinery",defaultContent:"",autoSave:!1},theme:{base:"themes/base/epiceditor.css",preview:"themes/preview/refinery.css",editor:"themes/editor/refinery.css"},button:{preview:!0,fullscreen:!0},focusOnLoad:!1,shortcut:{modifier:18,fullscreen:70,preview:80},
string:{togglePreview:t("refinery.editor.toggle_preview_mode"),toggleEdit:t("refinery.editor.toggle_edit_mode"),toggleFullscreen:t("refinery.editor.enter_fullscreen")}},editor:null,insert:function(c){this.editor.edit();this.editor.editorIframeDocument.execCommand("insertText",!1,c)},g:function(){var c=this,a=c.b,b,a=$("<button/>",{title:t("refinery.editor.images_dialog_button_title"),"class":"editor-images-dialog-btn refinery-btn"}).prependTo(a);b=refinery("admin.ImagesDialog");a.on("click",function(a){a.preventDefault();
a.stopPropagation();b.init().open();return!1});b.on("insert",function(a){var b="![%alt](%url)";a.url?(b=b.replace("%alt",a.alt),b=b.replace("%url",a.url),c.insert(b)):c.f(a.id)});c.a=b},f:function(c){var a=this,b;b=refinery("admin.ImageDialog",{image_id:c,buttons:[{text:"Insert",click:function(){b.insert(b.holder)}},{text:"Back to the library",click:function(){b.close();a.a.open()}}]}).init();b.on("insert",function(d){var c;c="![%alt](%url)".replace("%alt",d.alt);c=c.replace("%url",d.sizes[d.size]);
a.insert(c);b.destroy(!0)});b.open()},i:function(){var c=this,a=c.b,b,a=$("<button/>",{title:t("refinery.editor.resources_dialog_button_title"),"class":"editor-resources-dialog-btn refinery-btn"}).prependTo(a);b=refinery("admin.ResourcesDialog");a.on("click",function(a){a.preventDefault();a.stopPropagation();b.init().open();return!1});b.on("insert",function(a){c.insert('<a href="'+a.url+'" class="file '+a.ext+'" title="'+a.name+" - "+a.size+' bytes " >'+a.name+"</a>")});c.c=b},h:function(){var c=
this,a=c.b,b,a=$("<button/>",{title:t("refinery.editor.pages_dialog_button_title"),"class":"editor-pages-dialog-btn refinery-btn"}).prependTo(a);b=refinery("admin.PagesDialog");a.on("click",function(a){a.preventDefault();a.stopPropagation();b.init().open();return!1});b.on("insert",function(a){var b;b="[%title](%url)".replace("%title",a.title);b=b.replace("%url",a.url);c.insert(b)});c.d=b},destroy:function(c){var a,b;if(this.is("initialised")){if(this.editor){a=$(this.options.textarea);b=a.val();try{this.editor.unload()}catch(d){"object"===
typeof console&&"function"===typeof console.log&&console.log(d)}this.editor=null;a.val(b)}this.a&&this.a.destroy(!0);this.c&&this.c.destroy(!0);this.d&&this.d.destroy(!0);this.holder.find(".epiceditor-holder").remove();this.e.remove()}this._destroy(c);return this},init:function(c){var a=this,b,d;a.is("initialisable")&&(a.is("initialising",!0),a.attach_holder(c),b=c.find("textarea"),d=$("<div/>",{"class":"epiceditor-holder"}).appendTo(c),a.options.container=d.get(0),a.options.textarea=b.get(0),b.hide(),
a.options.file.name="refinery"+this.uid,a.editor=new EpicEditor(a.options),a.editor.remove(a.options.file.name),a.editor.load(),a.b=$(a.editor.getElement("wrapper")).find("#epiceditor-utilbar"),a.e=$("<button/>",{"class":"epiceditor-toggle-button",text:t("refinery.editor.toggle_editor")}).appendTo(c),a.e.on("click",function(c){var e=b.val();c.preventDefault();d.toggle();b.toggle();b.is(":visible")?b.val(e):a.editor.importFile(a.options.file.name,e)}),a.g(),a.i(),a.h(),a.is({initialised:!0,initialising:!1}),
a.trigger("init"));return a}});refinery.admin.ui.editorEpicEditor=function(c){var a=c.find(".ui-tabs"),b=[];c.find("textarea.replace-with-editor").each(function(){var a=$(this).parent();b[b.length]=refinery("editor.EpicEditor").init(a)});a.on("tabsactivate",function(){for(var a=b.length-1;0<=a;a--)b[a].editor&&b[a].editor.reflow()})};}(window, jQuery));
